#!/bin/bash -e

SRC_DIRS=( "./conjur"
           "./pkg_bin" )

# Duplicate code linting error cannot be disabled:
# https://github.com/PyCQA/pylint/issues/214
DISABLED_ERRORS=( "fixme"
                  "duplicate-code" )

disabled_error_args=""
for disabled_error in ${DISABLED_ERRORS[@]}; do
  disabled_error_args+=" --disable $disabled_error"
done

echo "Building API container..."
docker-compose build

for src_dir in "${SRC_DIRS[@]}"; do
  echo "Checking linting in $src_dir..."
  set -x
  docker-compose run --rm \
    --no-deps \
    test \
    pylint -r n -f parseable $disabled_error_args "$src_dir"
done

echo "Linting completed!"
